Лекция № 2  "Архитектура ЭВМ"

План лекции:
	► История компьютеров
	► Устройство ЭВМ
	► Процессор x86
	► Защищённый режим
	
[00:10:53]  Каким был первый компьютер
	
	Можно считать машину Беббиджа (была сначала спроектирована, а сконструирована позже)
	Машина Тьюринга. Тьюринг-полный компьютер.
	Первенство в построении компьютера (работающего) принадлежит немцам.
	Сконструировали релейный компьютер.

[00:19:18]  Архитектура Фон-Неймана
	
		╔   				   ╗
		║        ПАМЯТЬ        ║
		╚   				   ╝
	      ↑↓              ↑↓
	║ Устройство  ║ → ║  АЛУ  ║
	║ управления] ║ ← ║       ║
						↑  ↓
					[ввод] [вывод]
	
	Чем отличается архитектура Фон-Неймана от других (например, от Гарвардской)
		► Память для данных и для команд одна и та же.
		Это может создавать проблемы для безопасности.
	
[00:21:00]  Какими бывают современные компьютеры

	Процессорные архитектуры. Классификация:
	
		RISC (Redused Instruction Set Computer)
			- MIPS - игровые консоли, маршрутизаторы
			- ARM - планшеты, телефоны, плееры,...
			- Power - серверы, игровые консоли, SAN
			- SPARC - серверы
		CISC (Complex Instruction Set Computer)
			- Pentium
		
		CRISC
			- PentiumPro+
		
		VLIW
			- Itanium2
	
	Преимущества RISC:
	+ можно увеличить скорость обработки, можно быстро наращивать тактовую частоту
	  (абсурдная реализация - процессоры, которые "не умеют" умножать)
	
	В CISC тактовая частота наращивается сложнее.
	Современные процессоры Intel не CISC. В них содержатся RISC-процессоры и есть микропрограмма,
	которая занимается декодированием сложных инструкций и разложением их на несколько простых.
	Ядрам отдаются команды на обработку полученных простых инструкций.
	+ = возможность обновления микропрограммы и устранения ошибок процессора.
	
	Проблема процессоров Pentium (90-е годы): F00F bug (ошибка F00F)
	Пользовательская программа без привелегий, начинавшаяся с двух байтов F0 0F полностью ОСТАНАВЛИВАЛА процессор.
	
	Процессоры Transmeta (Intel)
	  Идея процессоров: в них так же присутствует микропрограмма, но внутрь процессора засунули целый Linux.
	  Зачем? → Регулировать тепловыделение за счёт плавного замедления процессора, когда он несильно нагружен.
	  Технология Intel Speed Step (плавное изменение частоты процессора).
	  До этого у процессоров Intel было всего 2 частоты: высокая и низкая.
	
	64-разрядные инструкции - это разработка AMD.
	
[00:29:17]  Распространённые архитектуры процессоров
	
	x86  -  процессоры линейки 8086 (80286, 386,...)
		начиная с 80386 - 32-разрядные
		Проблема 32-разрядного набора инструкций: возможность оперировать только 4 Гб памяти.
	  ► AMD64
	  ► EMT64 (Extended Memory Technology)
	x86_64, x86_32
	    В чём проблема x86_64:
		  Если на ПК доступно 3 Гб памяти (RAM), и мы устанавливаем x64 ОС,
		  то мы ничего не выигрываем. ОС и процессы быстрее расходуют память в x64 OS.
		  Например, на один вызов подпрограммы сразу же выделяется 64 байта в стэк, независимо от количества аргументов.
		  Каждое число и каждый указатель = 64 бита (не 32), поэтому памяти расходуется в 2 раза больше (быстрее).

	[RISC]:	преимущество = низкое энергопотребление, низкое тепловыделение.
	  Целевое направление - мобильные устройства.
	  ARM:    мобильные телефоны.
	  MIPS:   маршрутизаторы
	...

[00:34:00]  Что у компьютера внутри?
	
	Разделение на Северный и Южный мосты, как следствие разной пропускной способности.
	В Северный мост выносили контроллер памяти, а с контроллером памяти нужно работать как можно быстрее.
	PCI-e вытеснил AGP

[00:39:20]  Что происходит после включения кx86-x64 компьютера?
	
	Он начинает тестировать устройства.
	- Кто опрашивает устройства?
	Микросхема памяти (постоянной, перепрограммируемой). Существует соглашение (например, Intel),
	по какому адресу передавать управление после включения компьютера.
	.S - файл ассемблера
	.c - файл с исходным кодом на языке C
	.C - файл с исходным кодом на языке C++
	
	Process state codes:
		D  -  uninterruptible sleep (usually IO)
		R  -  running or runnable (on run queue)
		S  -  interruptible sleep (waiting for an event to complete)
		T  -  stopped, either by a job control signal or because it is being traced
		W  -  paging (not valid since the 2.6.xx kernel)
		X  -  dead (should never be seen)
		Z  -  defunct ("zombie") process, terminated but not reaped by its parent
		
[00:44:00]  Сборка ядра. Файлы с исходными кодами ассемблера и C/C++
			   Сборка с помощью make. В помощь нам файл README (иногда бывает файл с именем INSTALL)
			   Если запустить make без параметров, то утилита
			   ► пробегается компилятором в соответствии с правилами, заключенными в утилиту,
			   ► собирает из каждого файла с исходными текстами объектный (промежуточный) файл
			   ► использует программу-линкер (ld (loader)) для того, чтобы получить окончательный файл ядра
			.asm → .sym (.sym, символьный файл, формируется для отладчика)

[00:48:20] Параметры qemu (make qemu-gdb)
	
	qemu-gdb    состоит в следующем:
		• собрать образ файловой системы (fs.img);
		• собрать образ ядра, с которого будет выполняться загрузка (например, xv6.img);
		• запустить отладчик (gdb)
		• запустить QEMU (эмулятор компьютера)
		